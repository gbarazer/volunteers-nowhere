<template name="metaleadDepartmentView">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-2 bg-grey user-top">
        <h3>{{ name }}</h3>
        <h5 class="mb-2 dark-text">{{__ "leads"}}</h5>
        <ul>
          {{#each lead in leadsDept}}
            <li>{{getUserName lead.userId}}</li>
          {{/each}}
        </ul>
        <h5 class="mb-2 dark-text">{{__ "information"}}</h5>
        <ul>
          <li>
            <div data-toggle="tooltip" data-placement="top" title="{{__ "total_number_of_teams"}}">
              {{__ "teams"}}: {{teamsNumber}}
            </div>
          </li>
          <li>
            <div data-toggle="tooltip" data-placement="top" title="{{__ "wanted_covered_confirmed"}}">
              {{__ "leads"}}: {{allLeads.wanted}}/{{allLeads.covered}}
            </div>
            </li>
          <li>
            <div data-toggle="tooltip" data-placement="top" title="{{__ "wanted_covered_confirmed"}}">
              {{__ "shifts"}}: {{shiftsDept.wanted}}/{{shiftsDept.covered}}
            </div>
          </li>
          <li>
            <div data-toggle="tooltip" data-placement="top" title="{{__ "total_number_of_volunteers"}}">
              {{__ "volunteer"}}: {{$len allVolunteers}}
            </div>
          </li>
        </ul>
        <button type="button" class="btn btn-default btn-sm" data-action="add_team">
          {{fa "wrench"}} {{__ "add_team" }}
        </button>
      </div>
      <div class="col-md-5 user-top">
        <h2 class="header">{{__ "all_teams"}}</h2>
        <table class="table">
          <thead>
            <th>{{__ "name"}}</th>
            <th>{{__ "leads"}}</th>
            <th>{{__ "wanted/covered"}}</th>
            <th></th>
          </thead>
          {{#each team in allTeams}}
            <tr class="{{#if $eq ($len (leadsTeam team)) 0 }}bg-warning{{/if}}">
              <td><a href="{{pathFor "leadTeamView" _id=team._id}}"> {{team.name}}</a></td>
              <td>
                <small>
                  <ul class="list-unstyled">
                  {{#each lead in (leadsTeam team)}}
                    <li>
                      {{lead.title}}:
                        {{#if lead.userId}}
                          {{getUserName lead.userId}}
                        {{else}}
                          <span class="text-warning">{{__ "vacant"}}</span>
                        {{/if}}
                    </li>
                  {{/each}}
                  </ul>
                </small>
              </td>
              <td><span class="badge badge-pill badge-primary">
                {{#let s = (shiftsTeam team._id)}}
                  {{s.wanted}}/{{s.covered}}
                {{/let}}
                </span></td>
              <td>
                <div class="btn-group pull-right">
                  <button type="button" class="btn btn-default dropdown-toggle"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu">
                    <li class="dropdown-item"><a href="#" data-action="edit_team" data-id="{{team._id}}">
                      {{fa "pencil-square-o"}} {{__ "edit"}}</a></li>
                    <li class="dropdown-item"><a href="#" data-action="delete_team" data-id="{{team._id}}">
                      {{fa "trash-o"}} {{__ "remove"}}</a></li>
                    <li class="dropdown-item"><a href="#" data-action="enroll_lead" data-id="{{team._id}}">
                      {{fa "user"}} {{__ "enroll_lead"}}</a></li>
                  </ul>
                </div>
              </td>
            </tr>
          {{/each}}
        </table>
        <!-- {{#markdown}}
        Collect and show all aggregated data regarding this department, including:

        - highlight teams that do not have a lead
        - highlight teams with a low completition rate
        - highlight teams with pending requests
        - show leads activity
        - nice graph showing the rate of signup over time
        - completition rate for the whole dept
        {{/markdown}} -->
      </div>
      <div class="col-md-5 user-top">
        <h2 class="header">{{__ "pending_lead_requests"}}</h2>
        {{> departmentSignupsList }}
      </div>
    </div>
  </div>
</template>
